<!DOCTYPE html><html><head><meta charset="utf-8"><style>body {
  width: 45em;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 30px;
}

@font-face {
  font-family: octicons-anchor;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAYcAA0AAAAACjQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAABMAAAABwAAAAca8vGTk9TLzIAAAFMAAAARAAAAFZG1VHVY21hcAAAAZAAAAA+AAABQgAP9AdjdnQgAAAB0AAAAAQAAAAEACICiGdhc3AAAAHUAAAACAAAAAj//wADZ2x5ZgAAAdwAAADRAAABEKyikaNoZWFkAAACsAAAAC0AAAA2AtXoA2hoZWEAAALgAAAAHAAAACQHngNFaG10eAAAAvwAAAAQAAAAEAwAACJsb2NhAAADDAAAAAoAAAAKALIAVG1heHAAAAMYAAAAHwAAACABEAB2bmFtZQAAAzgAAALBAAAFu3I9x/Nwb3N0AAAF/AAAAB0AAAAvaoFvbwAAAAEAAAAAzBdyYwAAAADP2IQvAAAAAM/bz7t4nGNgZGFgnMDAysDB1Ml0hoGBoR9CM75mMGLkYGBgYmBlZsAKAtJcUxgcPsR8iGF2+O/AEMPsznAYKMwIkgMA5REMOXicY2BgYGaAYBkGRgYQsAHyGMF8FgYFIM0ChED+h5j//yEk/3KoSgZGNgYYk4GRCUgwMaACRoZhDwCs7QgGAAAAIgKIAAAAAf//AAJ4nHWMMQrCQBBF/0zWrCCIKUQsTDCL2EXMohYGSSmorScInsRGL2DOYJe0Ntp7BK+gJ1BxF1stZvjz/v8DRghQzEc4kIgKwiAppcA9LtzKLSkdNhKFY3HF4lK69ExKslx7Xa+vPRVS43G98vG1DnkDMIBUgFN0MDXflU8tbaZOUkXUH0+U27RoRpOIyCKjbMCVejwypzJJG4jIwb43rfl6wbwanocrJm9XFYfskuVC5K/TPyczNU7b84CXcbxks1Un6H6tLH9vf2LRnn8Ax7A5WQAAAHicY2BkYGAA4teL1+yI57f5ysDNwgAC529f0kOmWRiYVgEpDgYmEA8AUzEKsQAAAHicY2BkYGB2+O/AEMPCAAJAkpEBFbAAADgKAe0EAAAiAAAAAAQAAAAEAAAAAAAAKgAqACoAiAAAeJxjYGRgYGBhsGFgYgABEMkFhAwM/xn0QAIAD6YBhwB4nI1Ty07cMBS9QwKlQapQW3VXySvEqDCZGbGaHULiIQ1FKgjWMxknMfLEke2A+IJu+wntrt/QbVf9gG75jK577Lg8K1qQPCfnnnt8fX1NRC/pmjrk/zprC+8D7tBy9DHgBXoWfQ44Av8t4Bj4Z8CLtBL9CniJluPXASf0Lm4CXqFX8Q84dOLnMB17N4c7tBo1AS/Qi+hTwBH4rwHHwN8DXqQ30XXAS7QaLwSc0Gn8NuAVWou/gFmnjLrEaEh9GmDdDGgL3B4JsrRPDU2hTOiMSuJUIdKQQayiAth69r6akSSFqIJuA19TrzCIaY8sIoxyrNIrL//pw7A2iMygkX5vDj+G+kuoLdX4GlGK/8Lnlz6/h9MpmoO9rafrz7ILXEHHaAx95s9lsI7AHNMBWEZHULnfAXwG9/ZqdzLI08iuwRloXE8kfhXYAvE23+23DU3t626rbs8/8adv+9DWknsHp3E17oCf+Z48rvEQNZ78paYM38qfk3v/u3l3u3GXN2Dmvmvpf1Srwk3pB/VSsp512bA/GG5i2WJ7wu430yQ5K3nFGiOqgtmSB5pJVSizwaacmUZzZhXLlZTq8qGGFY2YcSkqbth6aW1tRmlaCFs2016m5qn36SbJrqosG4uMV4aP2PHBmB3tjtmgN2izkGQyLWprekbIntJFing32a5rKWCN/SdSoga45EJykyQ7asZvHQ8PTm6cslIpwyeyjbVltNikc2HTR7YKh9LBl9DADC0U/jLcBZDKrMhUBfQBvXRzLtFtjU9eNHKin0x5InTqb8lNpfKv1s1xHzTXRqgKzek/mb7nB8RZTCDhGEX3kK/8Q75AmUM/eLkfA+0Hi908Kx4eNsMgudg5GLdRD7a84npi+YxNr5i5KIbW5izXas7cHXIMAau1OueZhfj+cOcP3P8MNIWLyYOBuxL6DRylJ4cAAAB4nGNgYoAALjDJyIAOWMCiTIxMLDmZedkABtIBygAAAA==) format('woff');
}

.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body strong {
  font-weight: bold;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px/1.4 Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  display: table;
  clear: both;
  content: "";
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code {
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
  font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}

.markdown-body .octicon {
  font: normal normal 16px octicons-anchor;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .octicon-link:before {
  content: '\f05c';
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .anchor {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  padding-left: 8px;
  margin-left: -30px;
  line-height: 1;
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  display: inline-block;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

.markdown-body .highlight {
  background: #fff;
}

.markdown-body .highlight .h {
  color: #333;
  font-style: normal;
  font-weight: normal;
}

.markdown-body .highlight .mf,
.markdown-body .highlight .mh,
.markdown-body .highlight .mi,
.markdown-body .highlight .mo,
.markdown-body .highlight .il,
.markdown-body .highlight .m {
  color: #945277;
}

.markdown-body .highlight .s,
.markdown-body .highlight .sb,
.markdown-body .highlight .sc,
.markdown-body .highlight .sd,
.markdown-body .highlight .s2,
.markdown-body .highlight .se,
.markdown-body .highlight .sh,
.markdown-body .highlight .si,
.markdown-body .highlight .sx,
.markdown-body .highlight .s1 {
  color: #df5000;
}

.markdown-body .highlight .kc,
.markdown-body .highlight .kd,
.markdown-body .highlight .kn,
.markdown-body .highlight .kp,
.markdown-body .highlight .kr,
.markdown-body .highlight .kt,
.markdown-body .highlight .k,
.markdown-body .highlight .o {
  font-weight: bold;
}

.markdown-body .highlight .kt {
  color: #458;
}

.markdown-body .highlight .c,
.markdown-body .highlight .cm,
.markdown-body .highlight .c1 {
  color: #998;
  font-style: italic;
}

.markdown-body .highlight .cp,
.markdown-body .highlight .cs,
.markdown-body .highlight .cp .h {
  color: #999;
  font-weight: bold;
}

.markdown-body .highlight .cs {
  font-style: italic;
}

.markdown-body .highlight .n {
  color: #333;
}

.markdown-body .highlight .na,
.markdown-body .highlight .nv,
.markdown-body .highlight .vc,
.markdown-body .highlight .vg,
.markdown-body .highlight .vi {
  color: #008080;
}

.markdown-body .highlight .nb {
  color: #0086B3;
}

.markdown-body .highlight .nc {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .no {
  color: #094e99;
}

.markdown-body .highlight .ni {
  color: #800080;
}

.markdown-body .highlight .ne {
  color: #990000;
  font-weight: bold;
}

.markdown-body .highlight .nf {
  color: #945277;
  font-weight: bold;
}

.markdown-body .highlight .nn {
  color: #555;
}

.markdown-body .highlight .nt {
  color: #000080;
}

.markdown-body .highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}

.markdown-body .highlight .gd {
  color: #000;
  background-color: #fdd;
}

.markdown-body .highlight .gd .x {
  color: #000;
  background-color: #faa;
}

.markdown-body .highlight .ge {
  font-style: italic;
}

.markdown-body .highlight .gr {
  color: #aa0000;
}

.markdown-body .highlight .gh {
  color: #999;
}

.markdown-body .highlight .gi {
  color: #000;
  background-color: #dfd;
}

.markdown-body .highlight .gi .x {
  color: #000;
  background-color: #afa;
}

.markdown-body .highlight .go {
  color: #888;
}

.markdown-body .highlight .gp {
  color: #555;
}

.markdown-body .highlight .gs {
  font-weight: bold;
}

.markdown-body .highlight .gu {
  color: #800080;
  font-weight: bold;
}

.markdown-body .highlight .gt {
  color: #aa0000;
}

.markdown-body .highlight .ow {
  font-weight: bold;
}

.markdown-body .highlight .w {
  color: #bbb;
}

.markdown-body .highlight .sr {
  color: #017936;
}

.markdown-body .highlight .ss {
  color: #8b467f;
}

.markdown-body .highlight .bp {
  color: #999;
}

.markdown-body .highlight .gc {
  color: #999;
  background-color: #EAF2F5;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  display: inline-block;
  padding: 3px 5px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height: 10px;
  color: #000;
  border: 1px solid #cfcfcf;
  border-radius: 2px;
}

.markdown-body .highlight .pl-coc,
.markdown-body .highlight .pl-entm,
.markdown-body .highlight .pl-eoa,
.markdown-body .highlight .pl-mai .pl-sf,
.markdown-body .highlight .pl-pdv,
.markdown-body .highlight .pl-sc,
.markdown-body .highlight .pl-sr,
.markdown-body .highlight .pl-v,
.markdown-body .highlight .pl-vpf {
  color: #0086b3;
}

.markdown-body .highlight .pl-eoac,
.markdown-body .highlight .pl-mdht,
.markdown-body .highlight .pl-mi1,
.markdown-body .highlight .pl-mri,
.markdown-body .highlight .pl-va,
.markdown-body .highlight .pl-vpu {
  color: #008080;
}

.markdown-body .highlight .pl-c,
.markdown-body .highlight .pl-pdc {
  color: #b4b7b4;
  font-style: italic;
}

.markdown-body .highlight .pl-k,
.markdown-body .highlight .pl-ko,
.markdown-body .highlight .pl-kolp,
.markdown-body .highlight .pl-mc,
.markdown-body .highlight .pl-mr,
.markdown-body .highlight .pl-ms,
.markdown-body .highlight .pl-s,
.markdown-body .highlight .pl-sok,
.markdown-body .highlight .pl-st {
  color: #6e5494;
}

.markdown-body .highlight .pl-ef,
.markdown-body .highlight .pl-enf,
.markdown-body .highlight .pl-enm,
.markdown-body .highlight .pl-entc,
.markdown-body .highlight .pl-eoi,
.markdown-body .highlight .pl-sf,
.markdown-body .highlight .pl-smc {
  color: #d12089;
}

.markdown-body .highlight .pl-ens,
.markdown-body .highlight .pl-eoai,
.markdown-body .highlight .pl-kos,
.markdown-body .highlight .pl-mh .pl-pdh,
.markdown-body .highlight .pl-mp,
.markdown-body .highlight .pl-pde,
.markdown-body .highlight .pl-stp {
  color: #458;
}

.markdown-body .highlight .pl-enti {
  color: #d12089;
  font-weight: bold;
}

.markdown-body .highlight .pl-cce,
.markdown-body .highlight .pl-enc,
.markdown-body .highlight .pl-kou,
.markdown-body .highlight .pl-mq {
  color: #f93;
}

.markdown-body .highlight .pl-mp1 .pl-sf {
  color: #458;
  font-weight: bold;
}

.markdown-body .highlight .pl-cos,
.markdown-body .highlight .pl-ent,
.markdown-body .highlight .pl-md,
.markdown-body .highlight .pl-mdhf,
.markdown-body .highlight .pl-ml,
.markdown-body .highlight .pl-pdc1,
.markdown-body .highlight .pl-pds,
.markdown-body .highlight .pl-s1,
.markdown-body .highlight .pl-scp,
.markdown-body .highlight .pl-sol {
  color: #df5000;
}

.markdown-body .highlight .pl-c1,
.markdown-body .highlight .pl-cn,
.markdown-body .highlight .pl-pse,
.markdown-body .highlight .pl-pse .pl-s2,
.markdown-body .highlight .pl-vi {
  color: #a31515;
}

.markdown-body .highlight .pl-mb,
.markdown-body .highlight .pl-pdb {
  color: #df5000;
  font-weight: bold;
}

.markdown-body .highlight .pl-mi,
.markdown-body .highlight .pl-pdi {
  color: #6e5494;
  font-style: italic;
}

.markdown-body .highlight .pl-ms1 {
  background-color: #f5f5f5;
}

.markdown-body .highlight .pl-mdh,
.markdown-body .highlight .pl-mdi {
  font-weight: bold;
}

.markdown-body .highlight .pl-mdr {
  color: #0086b3;
  font-weight: bold;
}

.markdown-body .highlight .pl-s2 {
  color: #333;
}

.markdown-body .highlight .pl-ii {
  background-color: #df5000;
  color: #fff;
}

.markdown-body .highlight .pl-ib {
  background-color: #f93;
}

.markdown-body .highlight .pl-id {
  background-color: #a31515;
  color: #fff;
}

.markdown-body .highlight .pl-iu {
  background-color: #b4b7b4;
}

.markdown-body .highlight .pl-mo {
  color: #969896;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  float: left;
  margin: 0.3em 0 0.25em -1.6em;
  vertical-align: middle;
}</style><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
MathJax.Hub.Config({
  config: ["MMLorHTML.js"],
  extensions: ["tex2jax.js"],
  jax: ["input/TeX"],
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: false
  },
  TeX: {
    extensions: ["AMSmath.js", "AMSsymbols.js"],
    TagSide: "right",
    TagIndent: ".8em",
    MultLineWidth: "85%",
    equationNumbers: {
      autoNumber: "AMS",
    },
    unicode: {
      fonts: "STIXGeneral,'Arial Unicode MS'"
    }
  },
  showProcessingMessages: false
});
</script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.2/raphael-min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
<script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.4/sequence-diagram-min.js"></script>
<script type="text/javascript">// flowchart, v1.3.4
// Copyright (c)2014 Adriano Raiano (adrai).
// Distributed under MIT license
// http://adrai.github.io/flowchart.js
!function(){function a(b,c){if(!b||"function"==typeof b)return c;var d={};for(var e in c)d[e]=c[e];for(e in b)b[e]&&(d[e]="object"==typeof d[e]?a(d[e],b[e]):b[e]);return d}function b(a,b){if("function"==typeof Object.create)a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});else{a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}}function c(a,b,c){var d,e,f="M{0},{1}";for(d=2,e=2*c.length+2;e>d;d+=2)f+=" L{"+d+"},{"+(d+1)+"}";var g=[b.x,b.y];for(d=0,e=c.length;e>d;d++)g.push(c[d].x),g.push(c[d].y);var h=a.paper.path(f,g);h.attr("stroke",a.options["element-color"]),h.attr("stroke-width",a.options["line-width"]);var i=a.options.font,j=a.options["font-family"],k=a.options["font-weight"];return i&&h.attr({font:i}),j&&h.attr({"font-family":j}),k&&h.attr({"font-weight":k}),h}function d(a,b,c,d){var e,f;"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);var g="M{0},{1}";for(e=2,f=2*c.length+2;f>e;e+=2)g+=" L{"+e+"},{"+(e+1)+"}";var h=[b.x,b.y];for(e=0,f=c.length;f>e;e++)h.push(c[e].x),h.push(c[e].y);var i=a.paper.path(g,h);i.attr({stroke:a.options["line-color"],"stroke-width":a.options["line-width"],"arrow-end":a.options["arrow-end"]});var j=a.options.font,k=a.options["font-family"],l=a.options["font-weight"];if(j&&i.attr({font:j}),k&&i.attr({"font-family":k}),l&&i.attr({"font-weight":l}),d){var m=!1,n=a.paper.text(0,0,d),o=!1,p=c[0];b.y===p.y&&(o=!0);var q=0,r=0;m?(q=b.x>p.x?b.x-(b.x-p.x)/2:p.x-(p.x-b.x)/2,r=b.y>p.y?b.y-(b.y-p.y)/2:p.y-(p.y-b.y)/2,o?(q-=n.getBBox().width/2,r-=a.options["text-margin"]):(q+=a.options["text-margin"],r-=n.getBBox().height/2)):(q=b.x,r=b.y,o?(q+=a.options["text-margin"]/2,r-=a.options["text-margin"]):(q+=a.options["text-margin"]/2,r+=a.options["text-margin"])),n.attr({"text-anchor":"start","font-size":a.options["font-size"],fill:a.options["font-color"],x:q,y:r}),j&&n.attr({font:j}),k&&n.attr({"font-family":k}),l&&n.attr({"font-weight":l})}return i}function e(a,b,c,d,e,f,g,h){var i,j,k,l,m,n={x:null,y:null,onLine1:!1,onLine2:!1};return i=(h-f)*(c-a)-(g-e)*(d-b),0===i?n:(j=b-f,k=a-e,l=(g-e)*j-(h-f)*k,m=(c-a)*j-(d-b)*k,j=l/i,k=m/i,n.x=a+j*(c-a),n.y=b+j*(d-b),j>0&&1>j&&(n.onLine1=!0),k>0&&1>k&&(n.onLine2=!0),n)}function f(a,b){b=b||{},this.paper=new Raphael(a),this.options=r.defaults(b,q),this.symbols=[],this.lines=[],this.start=null}function g(a,b,c){this.chart=a,this.group=this.chart.paper.set(),this.symbol=c,this.connectedTo=[],this.symbolType=b.symbolType,this.flowstate=b.flowstate||"future",this.next_direction=b.next&&b.direction_next?b.direction_next:void 0,this.text=this.chart.paper.text(0,0,b.text),b.key&&(this.text.node.id=b.key+"t"),this.text.node.setAttribute("class",this.getAttr("class")+"t"),this.text.attr({"text-anchor":"start",x:this.getAttr("text-margin"),fill:this.getAttr("font-color"),"font-size":this.getAttr("font-size")});var d=this.getAttr("font"),e=this.getAttr("font-family"),f=this.getAttr("font-weight");d&&this.text.attr({font:d}),e&&this.text.attr({"font-family":e}),f&&this.text.attr({"font-weight":f}),b.link&&this.text.attr("href",b.link),b.target&&this.text.attr("target",b.target);var g=this.getAttr("maxWidth");if(g){for(var h=b.text.split(" "),i="",j=0,k=h.length;k>j;j++){var l=h[j];this.text.attr("text",i+" "+l),i+=this.text.getBBox().width>g?"\n"+l:" "+l}this.text.attr("text",i.substring(1))}if(this.group.push(this.text),c){var m=this.getAttr("text-margin");c.attr({fill:this.getAttr("fill"),stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),width:this.text.getBBox().width+2*m,height:this.text.getBBox().height+2*m}),c.node.setAttribute("class",this.getAttr("class")),b.link&&c.attr("href",b.link),b.target&&c.attr("target",b.target),b.key&&(c.node.id=b.key),this.group.push(c),c.insertBefore(this.text),this.text.attr({y:c.getBBox().height/2}),this.initialize()}}function h(a,b){var c=a.paper.rect(0,0,0,0,20);b=b||{},b.text=b.text||"Start",g.call(this,a,b,c)}function i(a,b){var c=a.paper.rect(0,0,0,0,20);b=b||{},b.text=b.text||"End",g.call(this,a,b,c)}function j(a,b){var c=a.paper.rect(0,0,0,0);b=b||{},g.call(this,a,b,c)}function k(a,b){var c=a.paper.rect(0,0,0,0);b=b||{},g.call(this,a,b,c),c.attr({width:this.text.getBBox().width+4*this.getAttr("text-margin")}),this.text.attr({x:2*this.getAttr("text-margin")});var d=a.paper.rect(0,0,0,0);d.attr({x:this.getAttr("text-margin"),stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),width:this.text.getBBox().width+2*this.getAttr("text-margin"),height:this.text.getBBox().height+2*this.getAttr("text-margin"),fill:this.getAttr("fill")}),b.key&&(d.node.id=b.key+"i");var e=this.getAttr("font"),f=this.getAttr("font-family"),h=this.getAttr("font-weight");e&&d.attr({font:e}),f&&d.attr({"font-family":f}),h&&d.attr({"font-weight":h}),b.link&&d.attr("href",b.link),b.target&&d.attr("target",b.target),this.group.push(d),d.insertBefore(this.text),this.initialize()}function l(a,b){b=b||{},g.call(this,a,b),this.textMargin=this.getAttr("text-margin"),this.text.attr({x:3*this.textMargin});var d=this.text.getBBox().width+4*this.textMargin,e=this.text.getBBox().height+2*this.textMargin,f=this.textMargin,h=e/2,i={x:f,y:h},j=[{x:f-this.textMargin,y:e},{x:f-this.textMargin+d,y:e},{x:f-this.textMargin+d+2*this.textMargin,y:0},{x:f-this.textMargin+2*this.textMargin,y:0},{x:f,y:h}],k=c(a,i,j);k.attr({stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),fill:this.getAttr("fill")}),b.link&&k.attr("href",b.link),b.target&&k.attr("target",b.target),b.key&&(k.node.id=b.key),k.node.setAttribute("class",this.getAttr("class")),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),k.insertBefore(this.text),this.initialize()}function m(a,b){b=b||{},g.call(this,a,b),this.textMargin=this.getAttr("text-margin"),this.yes_direction="bottom",this.no_direction="right",b.yes&&b.direction_yes&&b.no&&!b.direction_no?"right"===b.direction_yes?(this.no_direction="bottom",this.yes_direction="right"):(this.no_direction="right",this.yes_direction="bottom"):b.yes&&!b.direction_yes&&b.no&&b.direction_no?"right"===b.direction_no?(this.yes_direction="bottom",this.no_direction="right"):(this.yes_direction="right",this.no_direction="bottom"):(this.yes_direction="bottom",this.no_direction="right"),this.yes_direction=this.yes_direction||"bottom",this.no_direction=this.no_direction||"right",this.text.attr({x:2*this.textMargin});var d=this.text.getBBox().width+3*this.textMargin;d+=d/2;var e=this.text.getBBox().height+2*this.textMargin;e+=e/2,e=Math.max(.5*d,e);var f=d/4,h=e/4;this.text.attr({x:f+this.textMargin/2});var i={x:f,y:h},j=[{x:f-d/4,y:h+e/4},{x:f-d/4+d/2,y:h+e/4+e/2},{x:f-d/4+d,y:h+e/4},{x:f-d/4+d/2,y:h+e/4-e/2},{x:f-d/4,y:h+e/4}],k=c(a,i,j);k.attr({stroke:this.getAttr("element-color"),"stroke-width":this.getAttr("line-width"),fill:this.getAttr("fill")}),b.link&&k.attr("href",b.link),b.target&&k.attr("target",b.target),b.key&&(k.node.id=b.key),k.node.setAttribute("class",this.getAttr("class")),this.text.attr({y:k.getBBox().height/2}),this.group.push(k),k.insertBefore(this.text),this.initialize()}function n(a){function b(a){var b=a.indexOf("(")+1,c=a.indexOf(")");return b>=0&&c>=0?d.symbols[a.substring(0,b-1)]:d.symbols[a]}function c(a){var b="next",c=a.indexOf("(")+1,d=a.indexOf(")");return c>=0&&d>=0&&(b=D.substring(c,d),b.indexOf(",")<0&&"yes"!==b&&"no"!==b&&(b="next, "+b)),b}a=a||"",a=a.trim();for(var d={symbols:{},start:null,drawSVG:function(a,b){function c(a){if(g[a.key])return g[a.key];switch(a.symbolType){case"start":g[a.key]=new h(e,a);break;case"end":g[a.key]=new i(e,a);break;case"operation":g[a.key]=new j(e,a);break;case"inputoutput":g[a.key]=new l(e,a);break;case"subroutine":g[a.key]=new k(e,a);break;case"condition":g[a.key]=new m(e,a);break;default:return new Error("Wrong symbol type!")}return g[a.key]}var d=this;this.diagram&&this.diagram.clean();var e=new f(a,b);this.diagram=e;var g={};!function n(a,b,f){var g=c(a);return d.start===a?e.startWith(g):b&&f&&!b.pathOk&&(b instanceof m?(f.yes===a&&b.yes(g),f.no===a&&b.no(g)):b.then(g)),g.pathOk?g:(g instanceof m?(a.yes&&n(a.yes,g,a),a.no&&n(a.no,g,a)):a.next&&n(a.next,g,a),g)}(this.start),e.render()},clean:function(){this.diagram.clean()}},e=[],g=0,n=1,o=a.length;o>n;n++)if("\n"===a[n]&&"\\"!==a[n-1]){var p=a.substring(g,n);g=n+1,e.push(p.replace(/\\\n/g,"\n"))}g<a.length&&e.push(a.substr(g));for(var q=1,r=e.length;r>q;){var s=e[q];s.indexOf(": ")<0&&s.indexOf("(")<0&&s.indexOf(")")<0&&s.indexOf("->")<0&&s.indexOf("=>")<0?(e[q-1]+="\n"+s,e.splice(q,1),r--):q++}for(;e.length>0;){var t=e.splice(0,1)[0];if(t.indexOf("=>")>=0){var u,v=t.split("=>"),w={key:v[0],symbolType:v[1],text:null,link:null,target:null,flowstate:null};if(w.symbolType.indexOf(": ")>=0&&(u=w.symbolType.split(": "),w.symbolType=u[0],w.text=u[1]),w.text&&w.text.indexOf(":>")>=0?(u=w.text.split(":>"),w.text=u[0],w.link=u[1]):w.symbolType.indexOf(":>")>=0&&(u=w.symbolType.split(":>"),w.symbolType=u[0],w.link=u[1]),w.symbolType.indexOf("\n")>=0&&(w.symbolType=w.symbolType.split("\n")[0]),w.link){var x=w.link.indexOf("[")+1,y=w.link.indexOf("]");x>=0&&y>=0&&(w.target=w.link.substring(x,y),w.link=w.link.substring(0,x-1))}if(w.text&&w.text.indexOf("|")>=0){var z=w.text.split("|");w.text=z[0],w.flowstate=z[1].trim()}d.symbols[w.key]=w}else if(t.indexOf("->")>=0)for(var A=t.split("->"),B=0,C=A.length;C>B;B++){var D=A[B],E=b(D),F=c(D),G=null;if(F.indexOf(",")>=0){var H=F.split(",");F=H[0],G=H[1].trim()}if(d.start||(d.start=E),C>B+1){var I=A[B+1];E[F]=b(I),E["direction_"+F]=G,G=null}}}return d}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var o=this,p={};"undefined"!=typeof module&&module.exports?module.exports=p:o.flowchart=o.flowchart||p;var q={x:0,y:0,"line-width":3,"line-length":50,"text-margin":10,"font-size":14,"font-color":"black","line-color":"black","element-color":"black",fill:"white","yes-text":"yes","no-text":"no","arrow-end":"block","class":"flowchart",symbols:{start:{},end:{},condition:{},inputoutput:{},operation:{},subroutine:{}}},r={defaults:a,inherits:b};f.prototype.handle=function(a){this.symbols.indexOf(a)<=-1&&this.symbols.push(a);var b=this;return a instanceof m?(a.yes=function(c){return a.yes_symbol=c,a.no_symbol&&(a.pathOk=!0),b.handle(c)},a.no=function(c){return a.no_symbol=c,a.yes_symbol&&(a.pathOk=!0),b.handle(c)}):a.then=function(c){return a.next=c,a.pathOk=!0,b.handle(c)},a},f.prototype.startWith=function(a){return this.start=a,this.handle(a)},f.prototype.render=function(){var a,b=0,c=0,d=0,e=0,f=0,g=0;for(d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.width>b&&(b=a.width),a.height>c&&(c=a.height);for(d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.shiftX(this.options.x+(b-a.width)/2+this.options["line-width"]),a.shiftY(this.options.y+(c-a.height)/2+this.options["line-width"]);for(this.start.render(),d=0,e=this.symbols.length;e>d;d++)a=this.symbols[d],a.renderLines();for(f=this.maxXFromLine,d=0,e=this.symbols.length;e>d;d++){a=this.symbols[d];var h=a.getX()+a.width,i=a.getY()+a.height;h>f&&(f=h),i>g&&(g=i)}this.paper.setSize(f+this.options["line-width"],g+this.options["line-width"])},f.prototype.clean=function(){if(this.paper){var a=this.paper.canvas;a.parentNode.removeChild(a)}},g.prototype.getAttr=function(a){if(!this.chart)return void 0;var b,c=this.chart.options?this.chart.options[a]:void 0,d=this.chart.options.symbols?this.chart.options.symbols[this.symbolType][a]:void 0;return this.chart.options.flowstate&&this.chart.options.flowstate[this.flowstate]&&(b=this.chart.options.flowstate[this.flowstate][a]),b||d||c},g.prototype.initialize=function(){this.group.transform("t"+this.getAttr("line-width")+","+this.getAttr("line-width")),this.width=this.group.getBBox().width,this.height=this.group.getBBox().height},g.prototype.getCenter=function(){return{x:this.getX()+this.width/2,y:this.getY()+this.height/2}},g.prototype.getX=function(){return this.group.getBBox().x},g.prototype.getY=function(){return this.group.getBBox().y},g.prototype.shiftX=function(a){this.group.transform("t"+(this.getX()+a)+","+this.getY())},g.prototype.setX=function(a){this.group.transform("t"+a+","+this.getY())},g.prototype.shiftY=function(a){this.group.transform("t"+this.getX()+","+(this.getY()+a))},g.prototype.setY=function(a){this.group.transform("t"+this.getX()+","+a)},g.prototype.getTop=function(){var a=this.getY(),b=this.getX()+this.width/2;return{x:b,y:a}},g.prototype.getBottom=function(){var a=this.getY()+this.height,b=this.getX()+this.width/2;return{x:b,y:a}},g.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX();return{x:b,y:a}},g.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width;return{x:b,y:a}},g.prototype.render=function(){if(this.next){var a=this.getAttr("line-length");if("right"===this.next_direction){var b=this.getRight();if(this.next.getLeft(),!this.next.isPositioned){this.next.setY(b.y-this.next.height/2),this.next.shiftX(this.group.getBBox().x+this.width+a);var c=this;!function e(){for(var b,d=!1,f=0,g=c.chart.symbols.length;g>f;f++){b=c.chart.symbols[f];var h=Math.abs(b.getCenter().x-c.next.getCenter().x);if(b.getCenter().y>c.next.getCenter().y&&h<=c.next.width/2){d=!0;break}}d&&(c.next.setX(b.getX()+b.width+a),e())}(),this.next.isPositioned=!0,this.next.render()}}else{var d=this.getBottom();this.next.getTop(),this.next.isPositioned||(this.next.shiftY(this.getY()+this.height+a),this.next.setX(d.x-this.next.width/2),this.next.isPositioned=!0,this.next.render())}}},g.prototype.renderLines=function(){this.next&&(this.next_direction?this.drawLineTo(this.next,"",this.next_direction):this.drawLineTo(this.next))},g.prototype.drawLineTo=function(a,b,c){this.connectedTo.indexOf(a)<0&&this.connectedTo.push(a);var f,g=this.getCenter().x,h=this.getCenter().y,i=(this.getTop(),this.getRight()),j=this.getBottom(),k=this.getLeft(),l=a.getCenter().x,m=a.getCenter().y,n=a.getTop(),o=a.getRight(),p=(a.getBottom(),a.getLeft()),q=g===l,r=h===m,s=m>h,t=h>m,u=g>l,v=l>g,w=0,x=this.getAttr("line-length"),y=this.getAttr("line-width");if(c&&"bottom"!==c||!q||!s)if(c&&"right"!==c||!r||!v)if(c&&"left"!==c||!r||!u)if(c&&"right"!==c||!q||!t)if(c&&"right"!==c||!q||!s)if(c&&"bottom"!==c||!u)if(c&&"bottom"!==c||!v)if(c&&"right"===c&&u)f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else if(c&&"right"===c&&v)f=d(this.chart,i,[{x:n.x,y:i.y},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else if(c&&"bottom"===c&&q&&t)f=d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:i.x+x/2,y:j.y+x/2},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+x/2;else if("left"===c&&q&&t){var z=k.x-x/2;p.x<k.x&&(z=p.x-x/2),f=d(this.chart,k,[{x:z,y:k.y},{x:z,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.leftStart=!0,a.topEnd=!0,w=k.x}else"left"===c&&(f=d(this.chart,k,[{x:n.x+(k.x-n.x)/2,y:k.y},{x:n.x+(k.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.leftStart=!0,a.topEnd=!0,w=k.x);else f=d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+(j.x-n.x)/2;else f=this.leftEnd&&t?d(this.chart,j,[{x:j.x,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:j.y+x/2},{x:j.x+(j.x-n.x)/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b):d(this.chart,j,[{x:j.x,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.bottomStart=!0,a.topEnd=!0,w=j.x+(j.x-n.x)/2;else f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else f=d(this.chart,i,[{x:i.x+x/2,y:i.y},{x:i.x+x/2,y:n.y-x/2},{x:n.x,y:n.y-x/2},{x:n.x,y:n.y}],b),this.rightStart=!0,a.topEnd=!0,w=i.x+x/2;else f=d(this.chart,k,o,b),this.leftStart=!0,a.rightEnd=!0,w=o.x;else f=d(this.chart,i,p,b),this.rightStart=!0,a.leftEnd=!0,w=p.x;else f=d(this.chart,j,n,b),this.bottomStart=!0,a.topEnd=!0,w=j.x;if(f){for(var A=0,B=this.chart.lines.length;B>A;A++)for(var C,D=this.chart.lines[A],E=D.attr("path"),F=f.attr("path"),G=0,H=E.length-1;H>G;G++){var I=[];I.push(["M",E[G][1],E[G][2]]),I.push(["L",E[G+1][1],E[G+1][2]]);for(var J=I[0][1],K=I[0][2],L=I[1][1],M=I[1][2],N=0,O=F.length-1;O>N;N++){var P=[];P.push(["M",F[N][1],F[N][2]]),P.push(["L",F[N+1][1],F[N+1][2]]);var Q=P[0][1],R=P[0][2],S=P[1][1],T=P[1][2],U=e(J,K,L,M,Q,R,S,T);if(U.onLine1&&U.onLine2){var V;R===T?Q>S?(V=["L",U.x+2*y,R],F.splice(N+1,0,V),V=["C",U.x+2*y,R,U.x,R-4*y,U.x-2*y,R],F.splice(N+2,0,V),f.attr("path",F)):(V=["L",U.x-2*y,R],F.splice(N+1,0,V),V=["C",U.x-2*y,R,U.x,R-4*y,U.x+2*y,R],F.splice(N+2,0,V),f.attr("path",F)):R>T?(V=["L",Q,U.y+2*y],F.splice(N+1,0,V),V=["C",Q,U.y+2*y,Q+4*y,U.y,Q,U.y-2*y],F.splice(N+2,0,V),f.attr("path",F)):(V=["L",Q,U.y-2*y],F.splice(N+1,0,V),V=["C",Q,U.y-2*y,Q+4*y,U.y,Q,U.y+2*y],F.splice(N+2,0,V),f.attr("path",F)),N+=2,C+=2}}}this.chart.lines.push(f)}(!this.chart.maxXFromLine||this.chart.maxXFromLine&&w>this.chart.maxXFromLine)&&(this.chart.maxXFromLine=w)},r.inherits(h,g),r.inherits(i,g),r.inherits(j,g),r.inherits(k,g),r.inherits(l,g),l.prototype.getLeft=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.textMargin;return{x:b,y:a}},l.prototype.getRight=function(){var a=this.getY()+this.group.getBBox().height/2,b=this.getX()+this.group.getBBox().width-this.textMargin;return{x:b,y:a}},r.inherits(m,g),m.prototype.render=function(){this.yes_direction&&(this[this.yes_direction+"_symbol"]=this.yes_symbol),this.no_direction&&(this[this.no_direction+"_symbol"]=this.no_symbol);var a=this.getAttr("line-length");if(this.bottom_symbol){var b=this.getBottom();this.bottom_symbol.getTop(),this.bottom_symbol.isPositioned||(this.bottom_symbol.shiftY(this.getY()+this.height+a),this.bottom_symbol.setX(b.x-this.bottom_symbol.width/2),this.bottom_symbol.isPositioned=!0,this.bottom_symbol.render())}if(this.right_symbol){var c=this.getRight();if(this.right_symbol.getLeft(),!this.right_symbol.isPositioned){this.right_symbol.setY(c.y-this.right_symbol.height/2),this.right_symbol.shiftX(this.group.getBBox().x+this.width+a);var d=this;!function e(){for(var b,c=!1,f=0,g=d.chart.symbols.length;g>f;f++){b=d.chart.symbols[f];var h=Math.abs(b.getCenter().x-d.right_symbol.getCenter().x);if(b.getCenter().y>d.right_symbol.getCenter().y&&h<=d.right_symbol.width/2){c=!0;break}}c&&(d.right_symbol.setX(b.getX()+b.width+a),e())}(),this.right_symbol.isPositioned=!0,this.right_symbol.render()}}},m.prototype.renderLines=function(){this.yes_symbol&&this.drawLineTo(this.yes_symbol,this.getAttr("yes-text"),this.yes_direction),this.no_symbol&&this.drawLineTo(this.no_symbol,this.getAttr("no-text"),this.no_direction)},p.parse=n}();
</script>
<script type="text/javascript">
(function (win, doc) {
  function onReady(fn) {
    if (doc.addEventListener) {
      doc.addEventListener('DOMContentLoaded', fn);
    } else {
      doc.attachEvent('onreadystatechange', function() {
        if (doc.readyState === 'interactive')
          fn();
      });
    }
  }

  win.convertUML = function(className, converter, settings) {
    var charts = doc.querySelectorAll("pre." + className),
        arr = [],
        i, j, maxItem, diagaram, text, curNode;

    // Is there a settings object?
    if (settings === void 0) {
        settings = {};
    }

    // Make sure we are dealing with an array
    for(i = 0, maxItem = charts.length; i < maxItem; i++) arr.push(charts[i])

    // Find the UML source element and get the text
    for (i = 0, maxItem = arr.length; i < maxItem; i++) {
        childEl = arr[i].firstChild;
        parentEl = childEl.parentNode;
        text = "";
        for (j = 0; j < childEl.childNodes.length; j++) {
            curNode = childEl.childNodes[j];
            whitespace = /^\s*$/;
            if (curNode.nodeName === "#text" && !(whitespace.test(curNode.nodeValue))) {
                text = curNode.nodeValue;
                break;
            }
        }

        // Do UML conversion and replace source
        el = doc.createElement('div');
        el.className = className;
        parentEl.parentNode.insertBefore(el, parentEl);
        parentEl.parentNode.removeChild(parentEl);
        diagram = converter.parse(text);
        diagram.drawSVG(el, settings);
    }
  }

  onReady(function(){convertUML('uml-flowchart', flowchart);});
  onReady(function(){convertUML('uml-sequence-diagram', Diagram, {theme: 'simple'});});
})(window, document)
</script>
<title>2015-10-11-23-52-02-bit_manipulation</title></head><body><article class="markdown-body"><hr>

<p>layout:     post
title:      Bit Manipulation
summary:    Tips and concepts associated with bit-manipulation and a few sample problems.
date:       2015-10-11 23-52-02</p>

<h2>
<a id="user-content-categories-bits-c-low-level-problems" class="anchor" href="#categories-bits-c-low-level-problems" aria-hidden="true"><span class="octicon octicon-link"></span></a>categories: bits, c++, low-level, problems</h2>

<p>Very often when working with programming languages that are just in any way higher level than assembly, such as when building web services, desktop applications, mobile apps -- you name it -- we may forget about the lower-level happenings in our systems: the bits and bytes and niddy-griddy details. Often, we actually <em>wish</em> to forget about those happenings and will abstract, encapsulate and wrap operations on those bits and bytes in classes and objects to make our lives easier. However, just as problematic it would be to have to deal with bit-manipulation to achieve even the simplest things and write even the simplest program, it is just as problematic to forget about how to flip bits, form masks and use the binary system to our advantage.</p>

<p>This post will outline a few tips and practical concepts regarding bit-manipulation and show how they can be used to solve actual problems (taken from <em><a href="http://goo.gl/yrtWHv">Cracking the Coding Interview</a></em>).</p>

<p>After reading this, you should be able to upgrade to this keyboard, for "real" programmers:</p>

<div>
    <a href="https://camo.githubusercontent.com/c0d9b81331bbf321bd278c5976cb95f9c11ca56c/687474703a2f2f676f6f2e676c2f5937646a6e44" target="_blank"><img src="https://camo.githubusercontent.com/c0d9b81331bbf321bd278c5976cb95f9c11ca56c/687474703a2f2f676f6f2e676c2f5937646a6e44" alt="keyboard" data-canonical-src="http://goo.gl/Y7djnD" style="max-width:100%;"></a>
</div>

<h2>
<a id="user-content-table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h2>





<ul>
<li>
<a href="#basic-concepts">Basic Concepts</a>

<ul>
<li><a href="#binary-operations">Binary Operations</a></li>
<li><a href="#bit-manipulation">Bit-Manipulation</a></li>
</ul>
</li>
<li>
<a href="#tricks">Tricks</a>

<ul>
<li><a href="#determining-if-a-value-is-a-power-of-two">Determining if a Value is a Power of Two</a></li>
<li><a href="#masks">Masks</a></li>
<li><a href="#finding-the-lsb">Finding the LSB</a></li>
</ul>
</li>
<li>
<a href="#problems">Problems</a>

<ul>
<li><a href="#determining-the-cardinality">Determining the Cardinality</a></li>
<li><a href="#bit-merging">Bit-Merging</a></li>
<li><a href="#floating-point-representation">Floating-Point Representation</a></li>
<li><a href="#bit-twins">Bit-Twins</a></li>
<li><a href="#edit-distance-for-bits">Edit-Distance for Bits</a></li>
<li><a href="#even-odd-bit-swapping">Even-Odd Bit-Swapping</a></li>
<li><a href="#drawing-a-line-in-a-monochrome-screen">Drawing a Line in a Monochrome Screen.</a></li>
</ul>
</li>
</ul>



<h2>
<a id="user-content-basic-concepts" class="anchor" href="#basic-concepts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic Concepts</h2>

<p>First, we should lay out the basics. I'm assuming you know what the binary system is, that it only uses the digits <code>0</code> and <code>1</code> and that the $n^{th}$ bit (including $0$) corresponds to a value of $2^n$.</p>

<p>Just some nomenclature:</p>

<ul>
<li>If a bit is <em>unset</em>, <em>low</em>, <em>LOW</em> or <em>cleared</em>, we mean it is 0.</li>
<li>If a bit is <em>set</em>, <em>high</em> or <em>HIGH</em>, we mean it is 1.</li>
<li>
<em>Setting</em> a bit means making 1.</li>
<li>
<em>Clearing</em> or <em>unsetting</em> a bit means making it 0.</li>
<li>The left-most-bit has the highest value and is thus termed the <em>most-significant-bit</em> (MSB).</li>
<li>The right-most-bit has the lowest value and is thus called the <em>least-sinificant-bit</em> (LSB).</li>
<li>The <em>cardinality</em> of a value refers to the number of bits it has <em>set</em> (i.e. the number of 1s.</li>
</ul>

<h3>
<a id="user-content-binary-operations" class="anchor" href="#binary-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Binary Operations</h3>

<p>Now follow basic binary concepts. You may very well be familiar with these operations, so feel free to skip them.</p>

<h4>
<a id="user-content-addition" class="anchor" href="#addition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Addition</h4>

<p>To add two binary values in your head, you can either first convert them to decimal and then do the addition there (and possibly re-convert the result to binary), or just do addition like you learnt it in primary school.</p>

<p><em>Example:</em> Perform the operation $1101_2 + 1010_2$</p>

<ol>
<li><p>Convert $1101_{2}$ to $13_{10}$ and $1010_2$ to $10_{10}$ and then easily do $13 + 10 = 23$</p></li>
<li>
<p>Write the two numbers beneath each other and follow the rules:</p>

<ul>
<li>$0 + 0$ give $0$</li>
<li>$0 + 1$ give $1$</li>
<li>$1 + 1$ give $0$ with a carry of $1$ (add that at the next digit)</li>
</ul>
</li>
</ol>

<div>
```
 1101
     +
 1010
_____
10111
```
</div>

<h4>
<a id="user-content-subtraction" class="anchor" href="#subtraction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Subtraction</h4>

<p>Analog for subtraction (with a little extra complexity for subtraction):</p>

<p><em>Example:</em> Perform the operation $1101_2 - 1010_2$</p>

<ol>
<li><p>Once more convert $1101_2$ to $13_{10}$ and $1010_2$ to $10_{10}$ and then do basic math $13 - 10 = 3$</p></li>
<li>
<p>Write the two numbers beneath each other and follow the rules:</p>

<ul>
<li>
<code>0 - 0</code> give <code>0</code>
</li>
<li>
<code>1 - 0</code> give <code>1</code>
</li>
<li>
<code>1 - 1</code> give <code>0</code>
</li>
<li>
<code>10 - 1</code> give <code>01</code> (borrow) and generally a <code>1</code> followed by $n$ <code>0</code>s gives a <code>0</code> followed by $n$ <code>1s</code>
</li>
</ul>
</li>
</ol>

<h4>
<a id="user-content-multiplication" class="anchor" href="#multiplication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiplication</h4>

<p>Multiplication is a bit more complicated, but basically involves shifting bits around:</p>

<p><em>Example:</em> Perform the operation $1101_2 \cdot 1010_2$</p>

<ol>
<li><p>$1101_2 \cdot 1010_2 = 13_{10} \cdot 10_{10} = 130$</p></li>
<li><p>For multiplication you have to work on a bit-by-bit basis and "multiply" each bit <code>A</code> in the one value by each bit <code>B</code> in the other value by shifting <code>B</code> over by the position of <code>B</code>. You then have to add the result of each shift operation. For example, with <code>x = 4 = 0b0100</code> and <code>y = 2 = 0b0010</code>, to do $x \cdot y$, you have to shift <code>x</code> over by the position of every bit in <code>y</code>. For <code>x</code>, here, there is only the $2^{nd}$ bit (<code>0</code>-indexed) and for <code>y</code> only the $1^{st}$. For the result, you would now have to shift <code>x</code> to the left by the index of the bit in <code>y</code>, i.e. by one position. The result is then <code>0b1000 = 8</code>. If there were more bits in <code>x</code>, you would repeat this for all other bits and add the results of each shift for the final result.</p></li>
</ol>

<p><code>
    1101
         x
    1010</code></p>

<hr>

<p>10000010
</p>

<h4>
<a id="user-content-or" class="anchor" href="#or" aria-hidden="true"><span class="octicon octicon-link"></span></a>OR</h4>

<p>The OR operation is the first binary-only operation (can't do it in decimal). In most programming languages, it is performed with the <code>|</code> (bar) operator. To OR two binary values, you follow the rules that, for every bit:</p>

<ul>
<li><code>0 | 0 = 0</code></li>
<li><code>0 | 1 = 1</code></li>
<li><code>1 | 1 = 1</code></li>
</ul>

<p>The basic idea is, the bit will be set if one <em>or</em> the other is, but you most likely know that from boolean expressions in programming.</p>

<h4>
<a id="user-content-and" class="anchor" href="#and" aria-hidden="true"><span class="octicon octicon-link"></span></a>AND</h4>

<p>For boolean AND -- usually represented by the <code>&amp;</code> (ampersand) character --, a bit is only set if both the bit in the first value <em>and</em> in the second value are set, such that:</p>

<ul>
<li><code>0 &amp; 0 = 0</code></li>
<li><code>0 &amp; 1 = 0</code></li>
<li><code>1 &amp; 1 = 1</code></li>
</ul>

<h4>
<a id="user-content-xor" class="anchor" href="#xor" aria-hidden="true"><span class="octicon octicon-link"></span></a>XOR</h4>

<p>XOR, short for "exclusive-OR", sets a bit only if the bits in the two values differ, i.e. if <code>bit1 != bit2</code>:</p>

<ul>
<li><code>0 ^ 0 = 0</code></li>
<li><code>0 ^ 1 = 1</code></li>
<li><code>1 ^ 1 = 0</code></li>
</ul>

<h4>
<a id="user-content-complement" class="anchor" href="#complement" aria-hidden="true"><span class="octicon octicon-link"></span></a>Complement</h4>

<p>Complementing, also called <em>twiddling</em>, <em>negating</em> or simply <em>flipping</em>, changes all $1$s to $0$s and vice-versa. Note that this is a <em>unary</em> operation, not a binary operation, meaning it is performed on only one value and not on/between two values (as is AND, OR and XOR). Its character is the tilde: <code>~</code>.</p>

<ul>
<li><code>~10101101 = 01010010</code></li>
<li><code>~1111 = 0000</code></li>
<li><code>~0 = 1</code></li>
</ul>

<h4>
<a id="user-content-shifting" class="anchor" href="#shifting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Shifting</h4>

<p>Shifting, to the left with <code>&lt;&lt;</code> and to the right with <code>&gt;&gt;</code>, shifts a binary value to the left or right by a certain number of bits. Note that in Java, there exist also the <code>&lt;&lt;&lt;</code> and <code>&gt;&gt;&gt;</code> operators, which also shift the sign-bit (while <code>&gt;&gt;</code> would only shift the bits to the right of the sign-bit).</p>

<ul>
<li><code>0001 &lt;&lt; 3 = 1000</code></li>
<li><code>1010 &gt;&gt; 2 = 0010</code></li>
</ul>

<h3>
<a id="user-content-bit-manipulation" class="anchor" href="#bit-manipulation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bit-Manipulation</h3>

<p>While the above paragraphs show how to use the operators available for bit operations, they do not yet answer questions such as how to set, clear or update bits. These manipulation-techniques are described below.</p>

<h4>
<a id="user-content-setting-bits" class="anchor" href="#setting-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting Bits</h4>

<p>For setting a bit, the OR operation is ideal, as OR-ing a bit with <code>1</code> will always result in that bit being <code>1</code>, whether it was <code>1</code> before or not. You may have first thought of XOR-ing an unset bit with <code>1</code>, but that would clear the bit if it was already set. That's why the common method is to do something along the lines of the following:</p>

<p>To set the $n^{th}$ bit (starting at 0) of a value <code>x</code>: <code>x |= (1 &lt;&lt; n)</code></p>

<ul>
<li><code>0000 | (1 &lt;&lt; 0) = 0000 | 0001 = 0001</code></li>
<li><code>1000 | (1 &lt;&lt; 1) = 1000 | 0001 = 1010</code></li>
<li>
<code>0100 | (1 &lt;&lt; 2) = 0100 | 0100 = 0100</code> (no change)</li>
</ul>

<p>For example, when working with microcontrollers, I always have a macro like this (note that this is for working with microcontrollers with a few KB of RAM where macros are often better than function calls, in any higher-level language you should always prefer functions):</p>

<p><code>#define SET_BIT(byte, bit) ((byte) |= (1UL &lt;&lt; (bit)))</code></p>

<h4>
<a id="user-content-clearing-bits" class="anchor" href="#clearing-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clearing Bits</h4>

<p>To clear a bit, we use the AND (<code>&amp;</code>) and NOT (<code>~</code>) operations. To clear/unset the $n^{th}$ bit of a value, the basic idea is to create a bit-mask with all bits set except for that $n^{th}$ bit, and then to AND the value with this mask. All bits that were previously set will be left alone, because <code>1 &amp; 1 = 1</code> and all bits that were unset will also remain unset, because <code>0 &amp; 1 = 0</code>. </p>

<p>To clear the $n^{th}$ bit of a value <code>x</code>: <code>x &amp;= ~(1 &lt;&lt; n)</code>.</p>

<ul>
<li><code>0111 &amp; ~(1 &lt;&lt; 0) = 0111 &amp; 1110 = 0110</code></li>
<li><code>0100 &amp; ~(1 &lt;&lt; 2) = 0100 &amp; 1011 = 0000</code></li>
<li>
<code>0111 &amp; ~(1 &lt;&lt; 3) = 0111 &amp; 0111 = 0111</code> (no change)</li>
</ul>

<p>Macro:</p>

<p><code>#define CLEAR_BIT(byte,bit) ((byte) &amp;= ~(1UL &lt;&lt; (bit)))</code></p>

<h4>
<a id="user-content-toggling-bits" class="anchor" href="#toggling-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Toggling Bits</h4>

<p>We use XOR with <code>1</code> to toggle a bit. This operation will always flip a <code>0</code> to a <code>1</code> and a <code>1</code> to a <code>0</code>.</p>

<p>To toggle the $n^{th}$ bit of a value <code>x</code>: <code>x ^= (1 &lt;&lt; n)</code></p>

<ul>
<li><code>0010 ^ (1 &lt;&lt; 1) = 0010 ^ 0010 = 0000</code></li>
<li><code>0110 ^ (1 &lt;&lt; 0) = 0110 ^ 0001 = 1111</code></li>
</ul>

<p>Macro:</p>

<p><code>#define TOGGLE_BIT(byte,bit) ((byte) ^= (1UL &lt;&lt; (bit)))</code></p>

<h4>
<a id="user-content-updating-bits" class="anchor" href="#updating-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating Bits</h4>

<p>Sometimes we may want to update a bit to specific value, stored in a variable. For this, we first have to clear the bit, and then OR it with the value.</p>

<p>To update the $n^{th}$ bit of a value <code>x</code>:</p>

<ol>
<li><code>x &amp;= ~(1 &lt;&lt; n)</code></li>
<li><code>x |= (1 &lt;&lt; value)</code></li>
</ol>

<h4>
<a id="user-content-checking-bits" class="anchor" href="#checking-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Checking Bits</h4>

<p>Of course, we'd also like to know if bits are set or not. For this, we AND the bit with a 1. If the bit was set, the result will be a 1 and else a 0. This also evaluates nicely to boolean true and false, thus you can use it in an if clause.</p>

<p>To check the $n^{th}$ bit of a value <code>x</code>: <code>x &amp; (1 &lt;&lt; n)</code></p>

<p>For example, you can check if a value is odd by AND-ing the first (i.e. $0^{th}$) bit:</p>

<p>{% gist a2b8114bb36eecf814e8 %}</p>

<p>I actually much prefer this way of checking for evenness, but most people are more familiar with the modulo method (even if <code>x % 2 == 0</code>) so I tend to stick with the modulo method for compliance.</p>

<p>Macro below. Note how here, after performing the AND operation, we shift the the result back to the right so that the set or cleared bit is at index 0. This is if we want to check the bit in a higher-bitwidth value and then store the result in a lower-bitwidth value, e.g. check the $31^{st}$ bit of a 32-bit unsigned integer and store the result in an 8-bit unsigned char. The bits more-significant than the $7^{th}$ bit get lost during casting.</p>

<p><code>#define IS_SET(byte,bit) (((byte) &amp; (1UL &lt;&lt; (bit))) &gt;&gt; (bit))</code></p>

<h2>
<a id="user-content-tricks" class="anchor" href="#tricks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tricks</h2>

<p>First, two simple tricks that can be useful for bit-manipulation.</p>

<h3>
<a id="user-content-determining-if-a-value-is-a-power-of-two" class="anchor" href="#determining-if-a-value-is-a-power-of-two" aria-hidden="true"><span class="octicon octicon-link"></span></a>Determining if a Value is a Power of Two</h3>

<p>The great thing about powers of two is that they occupy only a <em>single</em> bit in their binary representation. Thus, to determine if a value is a power of two, just check if they only have a single bit set. Easy! Right? In fact not so much. You could do something overkill like so:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> math

log <span class="pl-k">=</span> math.log2(value)

<span class="pl-k">if</span> <span class="pl-c1">int</span>(log) <span class="pl-k">==</span> log:
    ...</pre></div>

<p>But there's really a nice trick to doing this: A value <code>x</code> is a power of 2 if you can <code>AND</code> <code>x</code> with <code>x - 1</code> and have the result be <code>0</code>.</p>

<p>Example: <code>x = 16</code></p>

<pre><code>x:     00010000
                AND
x - 1: 00001111
_______________
       00000000
</code></pre>

<p>Counterexample: <code>x = 6</code></p>

<pre><code>x:     00000110
                AND
x - 1: 00000101
_______________
       00000100
</code></pre>

<h3>
<a id="user-content-masks" class="anchor" href="#masks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Masks</h3>

<h4>
<a id="user-content-of-exactly-n-bits" class="anchor" href="#of-exactly-n-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Of Exactly $N$ Bits</h4>

<p>To create a mask of <code>N</code> bits, shift 1 over by <code>N</code> positions to the left and subtract 1:</p>

<p><code>N = 4</code> (you want a mask of 4 bits): <code>(1 &lt;&lt; 4) - 1 = (10000) - 1 = 01111</code></p>

<h4>
<a id="user-content-of-all-odd-bits" class="anchor" href="#of-all-odd-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Of All Odd Bits</h4>

<p>To get a mask for all odd bits, use <code>0xA</code>, with one <code>A</code> every four bits (2 for a byte, 16 for a 64-bit <code>std::size_t</code> in C++).</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;&gt;</span> <span class="pl-c1">bin</span>(<span class="pl-c1">0x</span>AA)
<span class="pl-k">&gt;&gt;&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>0b10101010<span class="pl-pds">'</span></span> </pre></div>

<p>With the explanation that <code>0xA</code> in hex is <code>10</code> in decimal which is <code>0b1010</code> in binary (and the $1^{st}$ and $3^{rd}$ bits are set).</p>

<h4>
<a id="user-content-of-all-even-bits" class="anchor" href="#of-all-even-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Of All Even Bits</h4>

<p>The analog for all even bits is <code>0x5</code>, as <code>0x5</code> is <code>0b0101</code> in binary, where all even bits are set.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">&gt;&gt;&gt;</span> <span class="pl-c1">bin</span>(<span class="pl-c1">0x</span>55)
<span class="pl-s"><span class="pl-pds">'</span>0b1010101<span class="pl-pds">'</span></span></pre></div>

<h3>
<a id="user-content-finding-the-lsb" class="anchor" href="#finding-the-lsb" aria-hidden="true"><span class="octicon octicon-link"></span></a>Finding the LSB</h3>

<p>Your first inclination to find the least-significant-bit (LSB) may be to search all bits in order of increasing significance util a bit is set:</p>

<p>{% gist 869aa6080668d6c6e9e1 %}</p>

<p>While this works, its complexity is <code>O(N)</code> where <code>N</code> is the bitwidth of the data-type <code>T</code> used to represent the value. Using some super-awesome tricks we can get this down to constant-time:</p>

<p>Example: <code>A: 011010</code></p>

<p>First, subtract <code>1</code> from <code>A</code> to complement the bits before the LSB.</p>

<p><code>B: 011010 - 1 = 011001</code></p>

<p>Then, OR <code>A</code> with <code>B</code>, such that all bits before and including the LSB are set in <code>A</code>:</p>

<div class="highlight highlight-source-python"><pre>A: <span class="pl-c1">011010</span>
           OR
B: <span class="pl-c1">011001</span>
_________
C: <span class="pl-c1">011011</span></pre></div>

<p>The consequence is that when you now XOR <code>B</code> with <code>C</code>, the only position where bits differ is at the LSB (because you also set the bits before the LSB and the bits after it are unaffected).</p>

<pre><code>C: 011011
          XOR
B: 011001
_________
D: 000010
</code></pre>

<p>If you now take base-2 logarithm of this value you get the LSB position.</p>

<p>{% gist 80f422ff58e7772a026e %}</p>

<p>I know, it's a bit magic.</p>

<h2>
<a id="user-content-problems" class="anchor" href="#problems" aria-hidden="true"><span class="octicon octicon-link"></span></a>Problems</h2>

<p>Here follow some problems regarding bit-manipulation, many taken from <em><a href="http://goo.gl/yrtWHv">Cracking the Coding Interview</a></em>), to which all credit goes for them.</p>

<h3>
<a id="user-content-determining-the-cardinality" class="anchor" href="#determining-the-cardinality" aria-hidden="true"><span class="octicon octicon-link"></span></a>Determining the Cardinality</h3>

<p><em>Determine the cardinality of a value (how many bits are set).</em></p>

<p>We'll have to count, but optimize a bit by testing if the value is a power of 2 or one value before a power of 2.</p>

<p>{% gist a9b67def8fd0c77f3976 %}</p>

<h3>
<a id="user-content-bit-merging" class="anchor" href="#bit-merging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bit-Merging</h3>

<p><em>You are given two 32-bit number, <code>N</code> and <code>M</code>, and two bit positions <code>i</code> and <code>j</code> with <code>i</code> being less significant than <code>j</code>. Insert <code>M</code> into <code>N</code> at those positions.</em></p>

<p>Solution: Create a proper mask to unset the bits between <code>i</code> and <code>j</code> in <code>N</code>, then shift <code>M</code> over by <code>i</code> bits and <code>or</code> them.</p>

<ol>
<li>Create the mask.

<ul>
<li>For signed integers: <code>-~0 &lt;&lt; j | ((1 &lt;&lt; i) - 1)</code> (first set the bits to the left of the interval, then add, i.e. <code>or</code>, the bits to the right of it.)</li>
<li>For unsigned types also: <code>~(((1 &lt;&lt; (j - i)) - 1) &lt;&lt; i)</code> (create the mask of correct length, shift them into place, then twiddle).</li>
</ul>
</li>
<li>Binary <code>AND</code> <code>N</code> by the mask, to clear the relevant bits between i and j.</li>
<li>Simply "insert" <code>M</code> by <code>OR</code>ing <code>N</code> by <code>M</code>.</li>
</ol>

<p>{% gist 504808a000f2a196874a %}</p>

<h3>
<a id="user-content-floating-point-representation" class="anchor" href="#floating-point-representation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Floating-Point Representation</h3>

<p><em>Given a real number between 0 and 1, print its binary representation if it can be represented with at most 32 characters, else print "Error".</em></p>

<p>Note: Binary numbers are generally structured such that each bit signifies $0$ or $1 \cdot 2^N$. This is true for positive values, i.e. <code>101</code> means, from right to left, $1 \cdot 2^0 + 0 \cdot 2^1 + 1 \cdot 2^2 = 5$. But it is also true for negative values, where each digit to the right of the <code>0/1</code> bit stands for $1 \text{ or } 0 \cdot 2^{-N}$ (note the minus), such that <code>0.101</code> means $1 \cdot 2^{-1} = 1 \cdot \frac{1}{2} \dots$</p>

<p>Solution: Start with a "significance" of $0.5$ and see if we can subtract that significance from the floating-point value. If so, we add a 1 to our representation and subtract the significance from the value. If not, we add a 0 to the representation. Before each next iteration, we divide the significance by 2 to get $0.5, 0.25, 0.125, ...$</p>

<p>{% gist 3f50d1625b61e9b9d84e %}</p>

<h3>
<a id="user-content-bit-twins" class="anchor" href="#bit-twins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bit-Twins</h3>

<p><em>Given an integer with $N$ bits, find the next greater and smaller values with the same number of bits set as that integer.</em></p>

<p>Solution 1: Brute force. Increment the value and compute its cardinality each time, until the cardinality matches that of the original value. Same for decrementing. This algorithm's complexity would be $O(N \cdot B)$ where $N$ is the number of values we must check and $B$ the bitwidth of the data-type.</p>

<p>{% gist 74955a45ade6489facd5 %}</p>

<p>Solution 2: Go full-hardcore. See comments.</p>

<p>{% gist ff48d97864c7ddfc51e0 %}</p>

<h3>
<a id="user-content-edit-distance-for-bits" class="anchor" href="#edit-distance-for-bits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Edit-Distance for Bits</h3>

<p><em>Write a function to determine the number of bits you would need to flip to convert integer $A$ to integer $B$</em>.</p>

<p>Definitely, one would want to <code>XOR</code> the two integers to determine which bits differ. Then, it depends on how optimize the counting of bits.</p>

<p>Solution 1: Count between the LSB and MSB of the <code>XOR</code>ed value:</p>

<p>{% gist 70a1d0a85afbfac4393c %}</p>

<p>Solution 2: As above, but move to then next LSB each time (can skip some bits with a constant-time operation):</p>

<p>{% gist dfec8c309a85c9190dfc %}</p>

<h3>
<a id="user-content-even-odd-bit-swapping" class="anchor" href="#even-odd-bit-swapping" aria-hidden="true"><span class="octicon octicon-link"></span></a>Even-Odd Bit-Swapping</h3>

<p><em>Write a program to swap odd and even bits in an integer with as few instructions as possible</em></p>

<p>Solution 1: Iterative and inefficient.</p>

<p>{% gist f363b32517c78e5db048 %}</p>

<p>Solution 2: Mask off the odd bits and do shifting.</p>

<p>An appropriate mask for all odd bits is <code>0xAA</code> (two <code>A</code>s for every 8 bits / one for every 4). We first unset the odd bits, then shift the value to the left by one position to put the even bits into the odd positions. Then, we grab the odd bits, right shift (or left shift) those, and or the two sides.</p>

<p>{% gist e47dd2c01e349b274e10 %}</p>

<h3>
<a id="user-content-drawing-a-line-in-a-monochrome-screen" class="anchor" href="#drawing-a-line-in-a-monochrome-screen" aria-hidden="true"><span class="octicon octicon-link"></span></a>Drawing a Line in a Monochrome Screen.</h3>

<p><em>A monochrome screen is a single array of bytes, allowing eight consecutive pixels to be stored in one byte and <code>w</code> bytes in one row. Given a vertical row index <code>y</code> and two <code>x</code>-indices (bits in those bytes) <code>x_1</code> and <code>x_2</code>, write a function to draw a line between those bits, on that row.</em></p>

<p>Be careful about edge cases.</p>

<p>{% gist 542b40696a4271e551e7 %}</p>

<h2>
<a id="user-content-farewell" class="anchor" href="#farewell" aria-hidden="true"><span class="octicon octicon-link"></span></a>Farewell</h2>

<p>And that's it for this article on bit-manipulation. Hope you learnt something!</p>
</article></body></html>